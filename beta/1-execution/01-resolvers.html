<!DOCTYPE html>
<html lang="en">

<head>
    <base href="/tanka-graphql/beta/">
    <title>Resolvers - tanka-graphql</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="prism.css" />
    <style>
        body {
            height: 100%;
            width: 100%;         
        }

        a {
            color: rgba(0,0,0,.65);
        }

        a:hover {
            color: rgba(8, 8, 8, 0.65);
        }

        blockquote {
            border: 1px solid rgba(94, 94, 94, 0.65);
            border-left: 5px solid rgba(94, 94, 94, 0.65);
            padding: 0.75rem 1.5rem;
            margin-top: 1rem;
            margin-bottom: 1rem;            
        }

        .sidebar {
            margin-bottom: 1rem;
        }

        .sidebar .nav-link {
            display: block;
            padding: .25rem 1.5rem;
            font-size: 90%;
            color: rgba(0,0,0,.65);
        }

        .sidebar .nav-link:hover {
            text-decoration: underline;
        }

        .content h1,
        .content h2,
        .content h3,
        .content h4,
        .content h5,
        .content h6 {
            font-weight: 300;
        }

        
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Tanka GraphQL</a>
        <ul class="navbar-nav px-3">
            <li class="nav-item text-nowrap">
                <a class="nav-link" href="https://github.com/pekkah/tanka-graphql">GitHub</a>
            </li>
        </ul>
    </nav>
    <div class="container-fluid">
        <div class="row flex-xl-nowrap">
            <nav class="col-12 col-md-3 col-xl-2 sidebar">
                <div class="sidebar-sticky">
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="benchmarks.html">Benchmarks</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
<h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="0-getting-started/01-create-schema.html">Getting started</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="0-getting-started/01-create-schema.html">Create schema</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="0-getting-started/02-bind-resolvers.html">Bind resolvers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="0-getting-started/03-apply-directives.html">Apply directives</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="0-getting-started/04-server.html">Server</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="0-getting-started/05-dependency-injection.html">Dependency injection</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
</ul><h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="1-execution/01-resolvers.html">Execution</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link active bg-light" href="1-execution/01-resolvers.html">Resolvers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="1-execution/03-mutation.html">Mutation</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="1-execution/04-query.html">Query</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="1-execution/05-subscription.html">Subscription</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="1-execution/06-validation.html">Validation</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
</ul><h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="2-server/0-common.html">Server</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="2-server/0-common.html">Common</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="2-server/1-tracing.html">Tracing</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="2-server/2-query-cost-limit.html">Query cost limit</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
<h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="2-server/1-signalR/1-signalr-hub.html">SignalR</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="2-server/1-signalR/1-signalr-hub.html">Signalr hub</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="2-server/1-signalR/2-apollo-link.html">Apollo link</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
</ul><h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="2-server/2-graphql-ws/3-graphql-ws.html">Graphql ws</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="2-server/2-graphql-ws/3-graphql-ws.html">Graphql ws</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
</ul></ul><h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="5-extensions/5-query-cost-analysis.html">Extensions</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="5-extensions/5-query-cost-analysis.html">Query cost analysis</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="5-extensions/9-dotnet-client.html">Dotnet client</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
</ul><h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="6-introspection/4-type-name-introspection.html">Introspection</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="6-introspection/4-type-name-introspection.html">Type name introspection</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="6-introspection/5-schema-introspection.html">Schema introspection</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
</ul><h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
    <a class="d-flex align-items-center text-muted" href="7-type-system/00-SDL.html">Type system</a>
</h6>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/00-SDL.html">SDL</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/01-builder.html">Builder</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/02-schema.html">Schema</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/04-types.html">Types</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/05-scalars.html">Scalars</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/06-objects.html">Objects</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/07-interfaces.html">Interfaces</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/08-unions.html">Unions</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/09-enums.html">Enums</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/10-input-objects.html">Input objects</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/11-list.html">List</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/12-non-null.html">Non null</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="7-type-system/13-directives.html">Directives</a>
        </li>
    </ul>
<ul class="nav flex-column" style="margin-left: 0.5rem; font-size: 96%;">
</ul></ul>                </div>
            </nav>
            <main role="main" class="col-12 col-md-8 col-xl-6 py-sm-1 py-md-3 pl-md-5 content">
                <h2 id="resolvers">Resolvers</h2>
<p>Resolving values is done with two specialized delegates. One is used resolving values and one for subscribing to streams when using subscriptions.</p>
<p>Resolve fields
<pre><code class="language-csharp">    public delegate ValueTask&lt;IResolverResult&gt; Resolver(IResolverContext context);
</code></pre></p>
<p>Resolve subscription event streams
<pre><code class="language-csharp">    public delegate ValueTask&lt;ISubscriberResult&gt; Subscriber(IResolverContext context, CancellationToken unsubscribe);
</code></pre></p>
<h3 id="resolver">Resolver</h3>
<p>When executing query or mutation <code>Resolver</code> is used to resolve the value of the field. Resolver can use the context to access field arguments, schema, and other details about the context of the execution.</p>
<h3 id="subscriber">Subscriber</h3>
<p>When executing subscription the <code>Subscriber</code> is used to resolve the event stream to subscribe into. Both <code>Subscriber</code> and <code>Resolver</code> are required for field when using subscriptions.</p>
<p><code>Subscriber</code> is responsible for resolving the source stream part of the <a href="https://facebook.github.io/graphql/June2018/#sec-Source-Stream">Specification</a>.</p>
<p><code>Resolver</code> is responsible for resolving the source stream values <a href="https://facebook.github.io/graphql/June2018/#sec-Response-Stream">Specification</a></p>
<h4 id="unsubscribe">Unsubscribe</h4>
<p><code>Subscriber</code> is given a cancellation token <code>unsubscribe</code> which will change into cancelled state when the request is unsubscribed <a href="https://facebook.github.io/graphql/June2018/#sec-Unsubscribe">Specification</a>.</p>
<h3 id="building-resolvers-with-fields">Building resolvers with fields</h3>
<p>Resolvers can be configured when creating fields. This configuration is used to build the actual resolver when <code>Schema</code> is built.</p>
<p><pre><code class="language-csharp">
        [Fact]
        public async Task Create_Field_Resolver()
        {
            /* Given */
            var builder = new SchemaBuilder();
            builder.Query(out var query)
                .Connections(connections =&gt;
                {
                    connections.Field(query, &quot;field1&quot;, ScalarType.String,
                        &quot;test field&quot;,
                        resolve =&gt; resolve.Run(context =&gt; new ValueTask&lt;IResolverResult&gt;(Resolve.As(42))));
                });


            /* When */
            var sut = builder.Build();

            /* Then */
            var result = await sut.GetResolver(query.Name, &quot;field1&quot;)(null);
            Assert.Equal(42, result.Value);
        }
</code></pre></p>
<p><pre><code class="language-csharp">
        [Fact]
        public async Task Create_Field_Subscriber()
        {
            /* Given */
            var builder = new SchemaBuilder();
            builder.Query(out var query)
                .Connections(connections =&gt;
                {
                    connections.Field(query, &quot;field1&quot;, ScalarType.String,
                        &quot;test field&quot;,
                        resolve =&gt; resolve.Run(context =&gt; 
                            ResolveSync.As(42)),
                        subscribe =&gt; subscribe.Run((context, unsubscribe) =&gt; 
                            ResolveSync.Subscribe(new EventChannel&lt;object&gt;(), unsubscribe)));
                });


            /* When */
            var sut = builder.Build();

            /* Then */
            var result = await sut.GetSubscriber(query.Name, &quot;field1&quot;)(null, CancellationToken.None);
            Assert.NotNull(result.Reader);
        }
</code></pre></p>
<p>Resolver middlwares can be used to build an execution chain.</p>
<p>Middlwares are implemented as a delegate method taking in the context and delegate for the next middlware to execute. Last link in the chain is usually the actual resolver but chain can be also interrupted before it by returning a result from the middleware.</p>
<p>Signature of the value resolver middlware:
<pre><code class="language-csharp">    public delegate ValueTask&lt;IResolverResult&gt; ResolverMiddleware(IResolverContext context, Resolver next);
</code></pre></p>
<p>Signature of the subscription middlware:
<pre><code class="language-csharp">    public delegate ValueTask&lt;ISubscriberResult&gt; SubscriberMiddleware(IResolverContext context, CancellationToken unsubscribe, Subscriber next);
</code></pre></p>
<h3 id="using-resolver-and-subscriber-maps">Using resolver and subscriber maps</h3>
<p>In some cases it's useful to be able to build the resolvers separately from the schema building. For that purpose <code>SchemaTools</code> provide a method to bind resolvers to fields by using <code>IResolverMap</code> and <code>ISubscriberMap</code>.</p>
<p><pre><code class="language-csharp">
        [Fact]
        public async Task Make_executable_schema()
        {
            /* Given */
            var schema1 = new SchemaBuilder()
                .Query(out var query1)
                .Connections(connect =&gt;
                    connect.Field(query1, &quot;field1&quot;, ScalarType.Int)
                )
                .Build();

            var resolvers = new ObjectTypeMap
            {
                {
                    query1.Name, new FieldResolversMap
                    {
                        {
                            &quot;field1&quot;, async context =&gt;
                            {
                                await Task.Delay(1);
                                return Resolve.As(1);
                            }
                        }
                    }
                }
            };

            /* When */
            var executableSchema = SchemaTools.MakeExecutableSchema(
                schema: schema1,
                resolvers: resolvers,
                subscribers: null);

            /* Then */
            var result = await Executor.ExecuteAsync(
                new ExecutionOptions
                {
                    Document = Parser.ParseDocument(@&quot;{ field1 }&quot;),
                    Schema = executableSchema
                });

            result.ShouldMatchJson(
                @&quot;{
                  &quot;&quot;data&quot;&quot;: {
                    &quot;&quot;field1&quot;&quot;: 1
                  }
                }&quot;);
        }
</code></pre></p>
<p>Dictionary based implementation is provided for setting up both resolvers and subscribers but other implementations can be easily provided.</p>
<p><pre><code class="language-csharp">    public interface IResolverMap
    {
        Resolver GetResolver(string typeName, string fieldName);
    }
</code></pre>
<pre><code class="language-csharp">    public interface ISubscriberMap
    {
        Subscriber GetSubscriber(string typeName, string fieldName);
    }
</code></pre></p>
                    
            </main>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="prism.js"></script>
</body>
</html>